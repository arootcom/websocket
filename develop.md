# Контур разработки

**Контур разработки** (Development Environment / Loop) — это изолированная среда, в которой программист пишет, запускает и тестирует код перед тем, как он попадет к пользователям.

Архитектура среды разработки реализована посредством спецификации docker-compose-dev.yaml

## Server

**Шаг 1** Запуск контура разработки

```
$ docker-compose -f docker-compose-dev.yaml up --remove-orphans
```

**Шаг 2**. Подключиться в режиме командной строки

```
$ docker exec -it ws-dev-server bash
```

**Шаг 3**. Запуск тестов

Все тесты

```
/usr/src/app# go test -v
```

Интеграционные тесты

1. Подключаение клиентом с включенной компрессией
2. Проверяем, что сервер подтвердил сжатие в заголовках
3. Отправление сообщения
4. Чтение ответа
5. Проверяем, что сервер реально обрывает связь на 64 КБ

```
/usr/src/app# go test -v -run TestCompressionWebSocketHandler
```

6. Подключение клиентом без компресии (должно блокироваться сервисом)

```
/usr/src/app# go test -v -run TestWebSocketHandler
```

> [!NOTE]
> Не покрыты тестами:
> 1. Timeout - не активное соединение должно отваливаться через 30 сек

**Шаг 4**. Завершение работы

```
$ docker-compose -f docker-compose-dev.yaml down
```

## Client

**Шаг 1** Запуск контура разработки

```
$ docker-compose -f docker-compose-dev.yaml up --remove-orphans
```

**Шаг 2**. Подключиться в режиме командной строки

```
$ docker exec -it ws-dev-server bash
```

**Шаг 3**. Запуск сервиса

```
/usr/src/app# go run main.go
```

**Шаг 4**. Подключиться в режиме командной строки

```
$ docker exec -it ws-dev-client bash
```

**Шаг 5** Запуск клиента

```
/usr/src/app# go run main.go
```

## Алтернативные клиенты

Для работы с алтернативными клиентами контур разработки должен быть запущен, а так же запущен сервис websocket.

**wscat** - это один из самых популярных и простых консольных инструментов для работы с WebSocket. Если curl предназначен для HTTP, то wscat для сокетов.

```
$ wscat -c ws://localhost/ws-notifications -P
```

