# Day 2: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π WebSocket-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å Nginx –∏ Docker

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ù–∞ –≤—Ç–æ—Ä–æ–º —ç—Ç–∞–ø–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è WebSocket-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –≤–æ–∑–Ω–∏–∫–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–æ—Ç–∏–ø –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏. –î–µ–Ω—å 1 –ø–æ–∫–∞–∑–∞–ª —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –±–∞–∑–æ–≤–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è, –Ω–æ —Ç–µ–ø–µ—Ä—å —Ç—Ä–µ–±—É–µ—Ç—Å—è:

- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ —Å–µ—Ä–≤–∏—Å–∞
- Reverse proxy –Ω–∞ –æ—Å–Ω–æ–≤–µ Nginx –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ö–æ–¥—è—â–∏–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ó–∞—â–∏—Ç–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —á–µ—Ä–µ–∑ TLS/SSL (WSS)
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –Ω–∞ —Ä–∞–∑–º–µ—Ä –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —Ç—ã—Å—è—á –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏ WebSocket-—Å–µ—Ä–≤–∏—Å–æ–≤ –≤–æ–∑–Ω–∏–∫–∞—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –≤—ã–∑–æ–≤—ã:

1. Stateful-–ø—Ä–∏—Ä–æ–¥–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ ‚Äî WebSocket –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, —á—Ç–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ–±—ã—á–Ω—ã–º HTTP
2. –¢–∞–π–º–∞—É—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ proxy ‚Äî Nginx –º–æ–∂–µ—Ç —Ä–∞–∑—Ä—ã–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è proxy_read_timeout, proxy_send_timeout
3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Äî –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç DoS-–∞—Ç–∞–∫ —á–µ—Ä–µ–∑ –ª–∏–º–∏—Ç—ã –Ω–∞ —Ä–∞–∑–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Äî —Å–ª–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—ã—Å—è—á –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
5. –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –Ω–∞–≥—Ä—É–∑–∫–∏

## –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

### 1. Nginx –∫–∞–∫ –ø—Ä–æ—Å—Ç–æ–π reverse proxy

‚úÖ –í—ã–±—Ä–∞–Ω–æ

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ù–∏–∑–∫–∏–π overhead
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏
- –®–∏—Ä–æ–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏
- –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ WebSocket —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã

–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:

- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–ª–∞—Å—Å–∏–∫—É (Round Robin, Least Connections, IP Hash)
- –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 2. Nginx —Å Lua –∏–ª–∏ JavaScript –º–æ–¥—É–ª—è–º–∏

‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º–∞—è –ª–æ–≥–∏–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏

–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:

- –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ë–æ–ª—å—à–∏–π overhead –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É
- –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–º –∫–æ–¥–µ
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ attack surface

### 3. –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∏ (HAProxy, Envoy)

‚ö†Ô∏è –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–æ, –æ—Ç–ª–æ–∂–µ–Ω–æ

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- –ë–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏. –°–∞–º—ã–π —à–∏—Ä–æ–∫–∏–π –≤—ã–±–æ—Ä ‚Äî –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö –¥–æ —Å–ª–æ–∂–Ω—ã—Ö (Round Robin, Static RR, Least Connections, First, Source Hash, URI Hash)
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:

- –ò–∑–±—ã—Ç–æ—á–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞
- –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ
- –ù–µ —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –Ω–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ

## –ü—Ä–∏–Ω—è—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Nginx –≤ —Ä–æ–ª–∏ –ø—Ä–æ—Å—Ç–æ–≥–æ reverse proxy –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ —Å–µ—Ä–≤–∏—Å–∞.

![](deploy.png)

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. Nginx ‚Äî reverse proxy —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –ª–∏–º–∏—Ç–æ–≤
2. Docker Compose ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ WebSocket-—Å–µ—Ä–≤–∏—Å–∞
3. Go-–∫–ª–∏–µ–Ω—Ç ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
4. TLS/SSL ‚Äî –∑–∞—â–∏—Ç–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —á–µ—Ä–µ–∑ WSS
5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Nginx ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Nginx –¥–ª—è WebSocket

```
worker_processes 1;

events { worker_connections 1024; }

http {
    upstream ws-servers {
        # Sticky sessions –≤–∞–∂–Ω—ã, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —Ö—Ä–∞–Ω–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–π—Ç –∫–ª–∏–µ–Ω—Ç–∞
        # ip_hash;

        # –ö–æ–≥–¥–∞ Nginx –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Ö–æ—Å—Ç—É wsserver, DNS-—Å–µ—Ä–≤–µ—Ä
        # Docker –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ IP-–∞–¥—Ä–µ—Å–æ–≤ –≤—Å–µ—Ö –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö —Ä–µ–ø–ª–∏–∫ —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.
        server ws-server:80;
    }

    map $http_upgrade $connection_upgrade {
        default upgrade;
        ''      close;
    }

    server {
        listen 443 ssl;
        server_name ws-nginx;

        ssl_certificate     /etc/nginx/localhost.pem;
        ssl_certificate_key /etc/nginx/localhost-key.pem;

        location /ws-notifications {
            proxy_pass http://ws-servers;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection $connection_upgrade;

            # –ó–∞–ø–∞—Å –≤ Nginx (90—Å) –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ –ø–∞–∫–µ—Ç –∑–∞–¥–µ—Ä–∂–∏—Ç—Å—è
            # –Ω–∞ 5-10 —Å–µ–∫—É–Ω–¥, –ø—Ä–æ–∫—Å–∏ –Ω–µ –æ–±—Ä—É–±–∏—Ç —Å–≤—è–∑—å "–∫–æ–¥–æ–º 1006"
            proxy_read_timeout 90s;
            proxy_send_timeout 90s;

            # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ (0 = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π).
            # –ü–æ–º–æ–≥–∞–µ—Ç, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
            client_max_body_size 0;

            # –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞.
            # –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –±–æ–ª—å—à–µ 128k, Nginx –∑–∞–ø–∏—à–µ—Ç –∏—Ö –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª.
            client_body_buffer_size 128k;

            # –û—Ç–∫–ª—é—á–∞–µ–º –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é, —á—Ç–æ–±—ã —Å–æ–æ–±—â–µ–Ω–∏—è —É–ª–µ—Ç–∞–ª–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
            proxy_buffering off;
        }

        location /status {
            stub_status;
        }
    }
}
```

#### Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```
version: '3.7'

networks:
  ws-notifications-network:
    name: ws-notifications-network
    driver: bridge

services:
  ws-nginx:
    container_name: ws-nginx
    image: ws-nginx
    build:
      context: ./
      dockerfile: Dockerfile.nginx
    restart: unless-stopped
    tty: true
    volumes:
      - ./nginx/:/etc/nginx/
    ports:
      - 443:443
    networks:
      - ws-notifications-network
    depends_on:
      - ws-server
  ws-server:
    image: ws-server
    build:
      context: ./
      dockerfile: Dockerfile.server
    networks:
      - ws-notifications-network
  ws-client:
    image: ws-client
    build:
      context: ./
      dockerfile: Dockerfile.client
    volumes:
      - ./client:/usr/src/app
    environment:
      WS_SCHEME: wss
      WS_HOSTNAME: ws-nginx
    networks:
      - ws-notifications-network
    depends_on:
      - ws-nginx
```

#### Go-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

- –ò–º–∏—Ç–∞—Ü–∏—è —Ç—ã—Å—è—á –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –Ω–∞–≥—Ä—É–∑–∫–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–¥–µ—Ä–∂–µ–∫ –∏ –æ—à–∏–±–æ–∫
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ WSS

#### –õ–∏–º–∏—Ç—ã –Ω–∞ —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö

| –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ª–∏–º–∏—Ç | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ | 
|-----------|---------------------|-------------| 
| –¢–µ–∫—Å—Ç/JSON | 1-5 –ú–ë | –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –≥–∏–±–∫–æ—Å—Ç—å—é –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç DoS | 
| –ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | 10-50 –ú–ë | –î–ª—è —Ñ–∞–π–ª–æ–≤, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | 
| –ó–∞—â–∏—Ç–∞ Nginx | 5 –ú–ë (client_max_body_size) | –ü–µ—Ä–≤–∞—è –ª–∏–Ω–∏—è –∑–∞—â–∏—Ç—ã | 
| –ó–∞—â–∏—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–¥–∞ | –í—Ç–æ—Ä–∞—è –ª–∏–Ω–∏—è –∑–∞—â–∏—Ç—ã |

#### –°–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö (permessage-deflate)

–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

- –ü–µ—Ä–µ–¥–∞—á–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ —Ç–µ–∫—Å—Ç–∞/JSON
- –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞

–ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

- –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU
- –ü–µ—Ä–µ–¥–∞—á–∞ —É–∂–µ —Å–∂–∞—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∏–¥–µ–æ)
- –¢—Ä–µ–±—É—é—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏

## –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

### –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ

‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Nginx –∫–æ–Ω—Ñ–∏–≥, –ø–æ–Ω—è—Ç–Ω—ã–π –ª—é–±–æ–º—É DevOps

‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî –Ω–∏–∑–∫–∏–π overhead, —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏

‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Äî –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ TLS/SSL + –ª–∏–º–∏—Ç—ã –Ω–∞ —Ä–∞–∑–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π

‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å ‚Äî –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Å–µ—Ä–≤–∏—Å–∞ —á–µ—Ä–µ–∑ Docker Compose

‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Nginx (–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å)

‚úÖ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π ‚Äî —Å–æ–∑–¥–∞–Ω Go-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ

‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ ‚Äî —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã (round-robin, least_conn)

‚ö†Ô∏è –í–Ω–µ—à–Ω–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

‚ö†Ô∏è Stateful-–ø—Ä–∏—Ä–æ–¥–∞ ‚Äî –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–π (—Ç—Ä–µ–±—É–µ—Ç—Å—è sticky sessions –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–µ–π—Å–æ–≤)

### –†–∏—Å–∫–∏

üî¥ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ ‚Üí —Ä–∞–∑—Ä—ã–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

–ú–∏—Ç–∏–≥–∞—Ü–∏—è: —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω-–ø–æ–¥–æ–±–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

üî¥ DoS-–∞—Ç–∞–∫–∏ ‚Üí –∏—Å—á–µ—Ä–ø–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

–ú–∏—Ç–∏–≥–∞—Ü–∏—è: –ª–∏–º–∏—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ Nginx + rate limiting + –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

üî¥ –û—Ç–∫–∞–∑ Nginx ‚Üí –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞

–ú–∏—Ç–∏–≥–∞—Ü–∏—è: High Availability –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ Nginx + keepalived)

## –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

–°—Ç–∞—Ç—É—Å: ‚úÖ –ü—Ä–∏–Ω—è—Ç–æ

–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 09.02.2026

–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 09.02.2026

–°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è: –í—ã–±–æ—Ä –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ WebSocket –¥–ª—è Go (coder/websocket –∫–∞–∫ –∑–æ–ª–æ—Ç–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞)

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: github.com/arootcom/websocket

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏

‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É —á–µ—Ä–µ–∑ Nginx

‚úÖ –°–æ–∑–¥–∞—Ç—å Go-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ Nginx (Prometheus + Grafana)

‚è≥ –í–Ω–µ–¥—Ä–∏—Ç—å sticky sessions –¥–ª—è stateful-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

‚è≥ –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—É—é HA (High Availability - –≤—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å) –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –Ω–∞ –±–∞–∑–µ NGINX

## –°—Å—ã–ª–∫–∏

- [Nginx WebSocket proxying](https://nginx.org/en/docs/http/websocket.html)
- [RFC 6455 - The WebSocket Protocol](https://tools.ietf.org/html/rfc6455)
- [–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–æ–µ–∫—Ç–∞](https://github.com/arootcom/websocket)
